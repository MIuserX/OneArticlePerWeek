## 原文

https://ieftimov.com/post/postgresql-indexes-btree/



## 翻译

​		关系型数据库中，索引是一个非常重要的特性，它缩短了我们查询数据的时间。在上一篇文章中：[the basics of indexes](https://ieftimov.com/postgresql-indexes-first-principles) ，我们讲了基本原理，并且知道我们如何在表上创建一个索引，并且测试它对我们查询的影响。在这篇文章中，我们仍然会看一些实现的细节，对于 PG 中最常用的索引：B-Tree。



### What is B-Tree?

​		从维基百科上看到的：

> 在计算机科学中，一个 B-Tree 是一个自平衡的树形数据结构，保持数据排序状态，并且允许查找、顺序访问、插入、删除操作，以 LOGn 时间复杂度。

​		真棒，这是真的嘛？基本上，它是个自排序的数据结构。这是它为什么自平衡的原因 - 它选择了它自己的形态。

> B-tree 是　二叉查找树，一个节点可以拥有超过两个的子节点。不像自平衡二叉查找树，B-tree 对于读写大块数据做了优化。

​		不像一般的二叉树，B-tree 可以拥有多个叶子节点，它基于自己平衡。同时，它的实现对于 I/O 进行了优化，这使得它适合做数据库的索引。

> B-tree 对于外存是一个好的例子。被广泛用于数据库和文件系统。

​		现在，对 B-tree 有了大量的理解。了解它们怎么工作是非常有趣的，所以让我们开始吧。



### Functionality

​		我们开始讲自平衡的 B-tree 之前，先说一个免责声明：有很多计算机科学的理论是关于 B-tree 的，但我们并不会涉及。例如，你可能首先想看一下二叉树，23-树，234树，在你深入了解 B-tree 之前。虽然如此，我们这里要讲到的内容依然对你理解B-tree 是如何工作的非常有帮助。

​		嘻嘻嘻，思考一下二叉树。在二叉树中，每个节点最多可以拥有两个子节点，因此叫做 二叉树。

​		GRAPH

​		好了，一个B-tree 是一个每个节点可以拥有多个子节点的，或者说，B-tree 可以拥有 N 个子节点。在二叉查找树中每个节点有一个值，B-tree 有个概念：**关键字**。关键字像一个值的列表，每个几点都有。

​		B-tree 也拥有概念：**阶**，一个阶为3的 B-tree 意味着每个非叶子节点可以拥有最多3个子节点。记住这个，这意味着每个节点最多拥有两个 (3-1) 关键字。

​		困惑吗？思考一下这个：一个非叶子节点，关键字是 `5,10`，你可以增加3个节点：

* 一个节点，值都小于 5
* 一个节点，值都在5和10之间
* 一个节点，值都大于10



​		我们将这个树画出来：

![img](https://ieftimov.com/b-tree-example-1.jpg)

​		关于 B-tree ，最重要的事是它们的平衡方面。这个概念基于每个节点都有关键字这个事实，像上面的例子。B-tree 平衡它们自己的方法非常有趣，关键字是这个功能的最重要的方面。

​		基本上，无论何时要添加一个新项目(或者，在我们的例子中，是个数字)，B-tree 为这个新项目寻找合适的位置(或节点)。例如，如果我们想添加数字 6，B-tree 将会 “寻找根节点”，在根节点上它应该将数字放置的位置。“寻找” 就是个比较操作，比较新的数字与节点的关键字。因为 6 大于 5，但是比 10 小（这是根节点的关键字），它将会创建一个新节点，在根节点之下：

![img](https://ieftimov.com/b-tree-example-2.jpg)